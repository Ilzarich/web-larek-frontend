# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовый код

### Класс ```Model<T>```

Абстрактный класс Model, который служит шаблоном для создания моделей данных с возможностью обработки событий.

#### Конструктор 

- принимает на вход ```container``` типа ```HTMLElement```

#### Методы 
- ```emmitChanges``` - регистрирует входящее событие в ```EventEmitter```

### ```Класс Component<T>```

Абстрактный класс Component, который служит шаблоном для создания компонентов пользовательского интерфейса. Класс предоставляет методы для манипулирования элементами HTML и отображения данных.

#### Конструктор
-  принимает на вход объект данных неявного типа и объект события типа ```IEvent```
- производит слияние входящего объекта с родительским 

#### Методы 
- ``` toggleClass``` - Переключает наличие указанного класса CSS у элемента. Если передан параметр force, то класс будет добавлен или удален в зависимости от значения этого параметра (true или false).
- ```setDisabled``` - Устанавливает или снимает атрибут disabled у элемента в зависимости от значения параметра state.
- ```setText``` - Устанавливает текстовое содержимое элемента, преобразовывая значение в строку. Этот метод защищен (protected), то есть доступен только внутри класса и его наследников.
- ```setImage``` - Устанавливает источник изображения (src) и, опционально, альтернативный текст (alt) для элемента img. Этот метод также защищен.
- ```render``` - Обновляет свойства компонента на основе переданных данных и возвращает контейнерный элемент. Использует метод Object.assign для копирования свойств из объекта data в текущий экземпляр компонента.

### Класс ```EventEmitter```
Класс ```EventEmitter``` обеспечивает работу событий. Функциональность класса стандартная: возможность установить/снять слушатели событий, вызвать слушателей при возникновении события.

### Класс ```Api``` 
Хранит основные поля и методы, необходимые при работе с сервером.\
Получает и хранит базовый url ```(baseUrl)``` и опции запроса ```(options)```.\
Методы позволяют обработать запрос, отправить и получить данные.

## Компоненты модели данных (Model)

### Класс ```LarekApi```
Класс ```LarekApi``` который расширяет базовый класс Api, чтобы взаимодействовать с конкретным API для получения списка продуктов и размещения заказов.

#### Конструктор 
- принимает передает в родительский конструктор ```Api``` поля ```baseUrl``` и ```options```
- принимает и сохраняет входящий ```url``` запроса в ```cdn```

#### Поля
- ```cdb``` - хранит входящий ```url```

#### Методы
- ```getProductList``` - для получения списка продуктов с сервера.
- ```orderProducts``` - для размещения заказа на сервере.


### Класс ```AppState```

Является моделью данных приложения в целом. Данный класс содержит в себе все основные группы данных страницы и методы работы с ними.

Тут распределяются данные частей приложения: каталог, превью, корзина, форма заказа

Расширяется базовым абстрактным классом ```Model<T>``` по интерфейсу ```IAppState```.

```
export interface IAppState {
  catalog: IProductItem[];
  preview: string;
  basket: string[];
  order: IOrder;
  total: string | number;
  loading: boolean;
}
```

#### Поля 
- ```catalog``` — Список продуктов в каталоге. Каждый продукт представлен объектом, который соответствует типу IProductItem
- ```preview``` — Ссылка или идентификатор на элемент, который в данный момент находится в режиме предварительного просмотра.
- ```basket``` — Список идентификаторов продуктов, добавленных в корзину. Это позволяет отслеживать, какие продукты пользователь добавил в свою корзину для последующей покупки.
- ```order``` — Данные текущего заказа. Это может включать в себя информацию о продуктах в заказе, их количестве, цене и другие данные, необходимые для оформления заказа.
- ```formErrors``` — Общая стоимость товаров в корзине. Это значение может быть представлено как числом или строкой, в зависимости от нужд приложения.

#### Методы 
- ```clearBasket``` - Очищает корзину и заказ, удаляя все элементы из массива basket и order.items.
- ```addToOrder``` - обавляет продукт в текущий заказ, добавляя его идентификатор в массив order.items.
- ```removeFromOrder``` - Удаляет продукт из текущего заказа, удаляя его идентификатор из массива order.items.
- ```setCatalog``` - Устанавливает каталог продуктов, преобразуя массив объектов IProductItem в массив объектов Product. После этого вызывается событие items:changed, чтобы уведомить другие части приложения об изменении каталога.
- ```setPreview``` - Устанавливает продукт для предварительного просмотра, обновляя свойство preview и вызывая событие preview:changed, чтобы уведомить другие части приложения об изменении предварительного просмотра.
- ```setProductToBasket``` - Добавляет продукт в корзину, добавляя его в массив basket.
- ```removeProductToBasket``` - Удаляет продукт из корзины, удаляя его из массива basket.
- ```get statusBasket``` - Геттер, который возвращает true, если корзина пуста, и false в противном случае.
- ```get bskt``` - Геттер, который возвращает текущий список продуктов в корзине.
- ```set total``` - Сеттер, который устанавливает общую стоимость заказа.
- ```getTotal``` - Метод, который вычисляет общую стоимость товаров в текущем заказе, суммируя цены продуктов, идентификаторы которых указаны в order.items
- ```setOrderField``` - Метод для установки значения поля заказа и проверки его валидности. Если заказ валидный, генерируется событие order:ready.
- ```setContactsField``` - Метод для установки значения контактного поля в заказе и проверки его валидности. Если контактные данные валидны, генерируется событие order:ready.
- ```validationOrder``` - Метод для проверки валидности полей заказа. Если поле address пустое, устанавливается ошибка. Обновляет объект formErrors и генерирует событие formErrors:change.
- ```validationContacts```  - Метод для проверки валидности контактных данных. Если поля email или phone пустые, устанавливаются соответствующие ошибки. Обновляет объект formErrors и генерирует событие formErrors:change.

### Класс ```ProductItem```

Является моделью хранения данных товара: идентификатора, заголовка, описания, категории, изображения, цены.

Расширяется базовым абстрактным классом ```Model<T>``` по интерфейсу ```IProductItem```
```
export interface IProductItem {
  id: string;
  title: string;
  description: string;
  category: string;
  image: string;
  price: number | null;
}
```

## Компоненты представления (View)
### Класс ```Card```
Класс ```Card``` представляет собой компонент пользовательского интерфейса, который используется для отображения карточек продуктов или других объектов с определенным набором данных. Он наследует от базового класса Component, что позволяет ему использовать общие методы для работы с DOM-элементами.

Расширяется базовым абстрактным классом ```Component<T>``` по интерфейсу ```ICard```
```
interface ICard {
  title: string;
  category: string;
  image: string;
  price: number;
  text: string;
}
```

#### Конструктор 
- передает ```container``` в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- если объект ```actions``` был передан, то вешает слушатель клика на ```container``` с вызовом объекта события ```actions```

#### Поля 
- ```_title``` - Ссылка на элемент DOM, который отображает название карточки. Этот элемент обновляется при изменении свойства ```title```.
- ```_category``` - Ссылка на элемент DOM, который отображает категорию карточки. Категория также используется для установки CSS-класса на элемент, чтобы изменить его стиль в зависимости от значения.
- ```_image``` - Ссылка на элемент изображения ```(<img>)```, который отображает картинку карточки. При изменении свойства image обновляется ```src``` этого элемента.
- ```_price``` - Ссылка на элемент DOM, который отображает цену карточки. При изменении свойства price обновляется текст этого элемента.
- ```_categoryColor``` - Словарь, который связывает категории карточек с CSS-классами. Эти классы используются для стилизации карточек в зависимости от их категории. Например, если категория "софт-скил", то применяется класс 

### Методы

- ```set title``` - Этот сеттер используется для установки текста элемента, отвечающего за заголовок карточки. Метод setText из базового класса Component обновляет содержимое элемента _title с новым значением value.
- ```set category``` - Этот сеттер обновляет текст элемента _category и устанавливает CSS-класс для элемента в зависимости от категории. Классы определяются в объекте _categoryColor. Это позволяет динамически изменять стили карточек в зависимости от их категории.
- ```set image``` - Этот сеттер обновляет атрибут src изображения для элемента _image и устанавливает alt-текст изображения на основе заголовка карточки. Метод setImage из базового класса Component используется для обновления изображения.
- ```set price``` -  Этот сеттер обновляет текст элемента _price, отображающего цену. Если значение value равно null, отображается текст "Бесценно". В противном случае отображается цена с текстом "синапсов".

### Класс ```CardPreview```

Интерфейс ICardPreview описывает структуру данных, необходимую для карточки предпросмотра\
Поля отвечают за связь с разметкой, методы за наполнение разметки данными.\
Расширяется классом ```Card<T>``` по интерфейсу ```ICardPreview```

```
interface ICardPreview {
  text: string;
}
```

#### Конструктор
- принимает container типа HTMLElement и опциональный объект события actions типа ICardActions
```
interface ICardActions {
  onClick: (event: MouseEvent) => void;
}
```
- передает container и actions в родительский конструктор

- сохраняет необходимые элементы разметки в полях

- если объект actions был передан, то вешает слушатель клика на _button с вызовом объекта события actions, слушатель с container при этом удаляется

#### Поля 
- ```_text``` - Находит кнопку в контейнере карточки по селектору
- ```_button``` - Использует утилиту ensureElement для получения элемента с текстом карточки по селектору ```.card__text```

#### Методы
- ```set text``` - Устанавливает текстовое содержимое элемента _text в карточке предпросмотра.

### Класс ```CardBasket```

Класс CardBasket представляет собой компонент пользовательского интерфейса, который отображает информацию о товаре в корзине. Он включает заголовок, цену, индекс и кнопку, и позволяет устанавливать текстовые значения для этих элементов. Класс также обрабатывает клики по кнопке, если передан соответствующий обработчик в конструктор.\
Расширяется базовым абстрактным классом ```Component<T>``` по интерфейсу ```ICardBasket```

```
interface ICardBasket {
  title: string;
  price: number;
  index: number;
}
```
#### Конструктор
- передает container в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- если объект actions был передан, то вешает слушатель клика на ```_button``` с вызовом объекта события ```actions```, слушатель с container при этом удаляется

#### Поля 
- ```_title``` - Ищет элемент с классом ```.card__title``` внутри контейнера и сохраняет его в свойство ```_title```. Функция ```ensureElement``` гарантирует, что элемент существует и возвращает его типизированным.
- ```_button``` - Ищет элемент с классом ```.card__button``` в контейнере и сохраняет его в свойство ``` _button```.
- ```_price``` - Ищет элемент с классом ```.card__price``` внутри контейнера и сохраняет его в свойство ```_price```.
- ```_index``` - Ищет элемент с классом ```.basket__item-index``` внутри контейнера и сохраняет его в свойство ```_index```

### Класс ```Page```

Класс Page представляет собой компонент страницы, который управляет некоторыми элементами интерфейса и взаимодействует с событиями.\
Расширяется базовым абстрактным классом ```Component<T>``` по интерфейсу ```IPage```

```
interface IPage {
  catalog: HTMLElement[]
}
```

#### Конструктор
- принимает ```container``` типа ```HTMLElement``` и объект ```event``` типа ```IEvent```
- передает ```container``` в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- вешает на кнопку корзины ```_basket``` слушатель события ```click```, при котором регистрируется событие ```basket:open```

#### Поля

- ```_counter``` - Ссылается на элемент с классом ```.header__basket-counter```, который, вероятно, отображает количество товаров в корзине.
- ```_catalog``` - Ссылается на элемент с классом ```.gallery```, который содержит каталог товаров.
- ```_wrapper``` - Ссылается на элемент с классом ```.page__wrapper```, который является обёрткой страницы и может быть использован для управления её стилями.
- ```_basket``` - Ссылается на элемент с классом ```.header__basket```, который представляет собой кнопку или ссылку для открытия корзины.

#### Методы
- ```set counter``` - Устанавливает текстовое значение элемента ```_counter```. Значение конвертируется в строку и устанавливается как текст содержимого элемента.
- ```set catalog``` - Заменяет все дочерние элементы элемента ```_catalog``` на переданный массив items. Это может быть использовано для обновления содержимого каталога товаров.
- ```set locked``` - Добавляет или удаляет класс ```page__wrapper_locked``` на элемент ```_wrapper``` в зависимости от значения value. Это может быть использовано для управления состоянием страницы, например, для блокировки взаимодействия с другими элементами на странице.

### Класс ```Modal```
Класс Modal реализует функциональность модального окна (или попапа) на веб-странице.\
Расширяется базовым абстрактным классом ```Component<T>``` по интерфейсу ```IModalData```

```
interface IModalData {
  content: HTMLElement;
}
```

#### Конструктор

- принимает ```container``` типа ```HTMLElement``` и объект event типа ```IEvent```
- передает ```container``` в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- вешает слушатель ```click``` на кнопку закрытия ```_closeButton``` и ```container``` с методом закрытия окна ```close``` в качестве колбека
- вешает слушатель ```click``` на content, для остановки распространения события при совершении клика на контенте модального окна. Иными словами — чтобы не закрыть окно при клике на его контент.

#### Поля
- ```_closeButton``` - Ссылка на элемент кнопки закрытия модального окна. Это кнопка, которая при нажатии закрывает модальное окно.
- ```_content ``` - Ссылка на элемент, который содержит контент модального окна. В этом элементе отображается переданное содержимое.

#### Методы
- ```set content``` - Устанавливает содержимое модального окна, заменяя все дочерние элементы элемента _content на переданный элемент value. Используется для динамического обновления содержимого модального окна.
- ```open``` - Открывает модальное окно, добавляя класс modal_active к контейнеру. Также отправляет событие modal:open, информируя другие части приложения о том, что модальное окно открыто.
- ```close``` - Закрывает модальное окно, удаляя класс modal_active из контейнера. Также очищает содержимое модального окна, устанавливая его в null, и отправляет событие modal:close, информируя другие части приложения о том, что модальное окно закрыто.
- ```render``` - Отвечает за рендеринг модального окна. Вызывает метод render родительского класса Component для выполнения базовой отрисовки. Затем открывает модальное окно и возвращает контейнер модального окна.

### Класс ```Basket```

Класс Basket представляет корзину покупок на веб-странице и управляет отображением элементов корзины и их общей стоимостью. Он наследуется от базового класса Component и использует утилитарные функции для работы с DOM элементами. \
Расширяется базовым абстрактным классом ```Component<T>``` по интерфейсу ```IBasket```

```
interface IBasket {
  items: HTMLElement[];
  total: number;
}
```

#### Конструктор
- принимает ```container``` типа ```HTMLElement``` и объект event типа ```IEvent```
- передает ```container``` в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- если есть ```button```, вешает на нее слушатель ```click``` с регистрацией события ```order:open``` в качестве колбека

#### Поля
- ```_list``` - Ссылка на элемент списка в корзине, который содержит все элементы корзины.
- ```_total``` -  Ссылка на элемент, показывающий общую стоимость корзины. 
- ```button``` -  Ссылка на кнопку в корзине, которая инициирует открытие страницы заказа
- ```items``` - хранит список товаров в корзине

#### Методы

- ```set items``` - Устанавливает элементы корзины. Если передан непустой массив элементов, то все текущие элементы списка заменяются на новые. Если массив пуст, то отображается сообщение "Корзина пуста".
- ```set total``` - Устанавливает общую стоимость корзины, преобразуя число total в строку и добавляя единицу измерения "синапсов". Обновляет текст элемента _total.

### Класс ```Order```
Класс Order, который управляет формой заказа.\
Расширяется классом ```Form<T>``` по интерфейсу ```IOrderForm```

```
export interface IOrderForm {
  payment?: string;
  address?: string;
  phone?: string;
  email?: string;
  total?: string | number;
}
```

#### Конструктор

- принимает ```container``` типа ```HTMLElement``` и объект event типа ```IEvent```
- передает ```container``` и ```event``` в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- на кнопки выбора формы оплаты вешает слушатель click по которому методом ```payment``` производится установка класса активности на эту самую кнопку
#### Поля

- ```_buttons``` — хранит разметку кнопок формы оплаты

#### Методы

- ```set payment``` — Устанавливает активное состояние кнопок.
- ```set address``` — Устанавливает значение поля с именем address в форме.

### Класс ```Contacts```
Класс Сontacts управляет контактной формой, устанавливая значения полей ```phone``` и ```email```.\
Расширяется классом ```Form<T>``` по интерфейсу ```IOrderForm```

#### Методы

- ```set phone``` — Устанавливает значение поля телефона
- ```set email``` — Устанавливает значение поля почты

### Класс ```Form<T>```
Отвечает за основные способы работы с формой и ее валидацию.\
Расширяется базовым абстрактным классом ```Component<T>``` по интерфейсу ```IFormState```

```
interface IFormState {
  valid: boolean;
  errors: string[];
}
```

#### Конструктор

- принимает ```container``` типа ```HTMLElement``` и объект event типа ```IEvent```
- передает ```container``` и event в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- вешает на ```container``` слушатель ```input``` при котором определяется поле воздействия, его имя и значение, которые после отправляются методу класса onInputChange в качестве аргументов
- вешает на ```container``` слушатель ```submit``` при котором происходит регистрация события с указанием имени ```container```

#### Поля

- ```_submit``` — хранит разметку кнопки отправки формы
- ```_errors``` — хранит разметку вывода ошибок валидации

#### Методы

- ```onInputChange``` — регистрирует событие с именем конкретного поля
- ```set valid``` — метод установки валидности
- ```set errors```— метод установки ошибки
- ```render``` — отрисовка формы и ее элементов


### Класс Success

Отвечает за отображение успешного оформления заказа в модальном окне. Можно сказать, что служит контентом для модалки.\
Расширяется базовым абстрактным классом ```Component<T>``` по интерфейсу ```ISuccess```\

```
interface ISuccess {
  total: number;
}
```

#### Конструктор

- принимает ```container``` типа ```HTMLElement``` и опциональный объект события ```actions``` типа ```ISuccessActions```
```
interface ISuccessActions {
  onClick: () => void;
}
```
- передает ```container``` в родительский конструктор

- сохраняет необходимые элементы разметки в полях

- если объект ```actions``` был передан, то вешает слушатель клика на ```_close``` с вызовом объекта события ```actions```

#### Поля

- ```_total``` — разметка общей суммы товаров в заказе
- ```_close``` — разметка кнопки закрытия окна

#### Методы

- ```set total``` — установка значения общей суммы