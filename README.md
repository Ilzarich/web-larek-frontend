# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара 
```
export interface ICard {
    _id: string;
    description: string;
    image: string;
    title: string
    category: string;
    price: string;
}
```

Пользователь 

```
export interface IUser { 
    payment: string;
    email: string;
    phone: string;
    address: string;
    total: string;
    items: string;
}
```

// Интерфейс корзины
```
export interface IBasket extends ICard, IUser {
    title: string;
    price: number;
    total: number;
}
```

 Тип данных карточки товора 
```
export type TCardInfo = Pick<ICard, 'category' | 'title' | 'image' | 'price'>;
```

 Тип данных картчоки товара в модалном окне
```
export type TCardModalInfo = Pick<ICard, 'image' | 'category' | 'title' | 'description' | 'price'>;
```

 Тип данных в модалке корзины 
```
export type TBasketInfo = Pick<IBasket, 'title' | 'price' | 'title'>;
```

 Тип данных в модальном окне оформления заказа способ оплаты и адрес
```
export type TModalOrderPayment = Pick<IUser, 'payment' | 'address'>;
```

 Тип данных в модальном окне офрмления заказа почта и телефон
```
export type TModalOrderData = Pick<IUser, 'email' | 'phone'>;
```

Тип данных в модальном окне после оформления заказа
```
export type TModalDecorated = Pick<IUser, 'total'>
```

### Слой данных 

#### Класс CardData
Класс отвечает за хранение и логику работы с даннымы карточками для добавления в корзину\ 
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- `cards: ICard[];` - массив объектов карточек
- `_preview: string | null` - id карточки, выбранной для просмотра в модальной окне

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `addBasket(cardId: string, payload: Function | null):void` - данный метод позоляет отправить выбранный товар в корзину

#### Класс BasketData 
Класс отвечает за хранение и логику работы с данными элементов попавших в корзину\ 
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- `title: string;` - Заголовок товара 
- `price: number;` - Цена товара 
- `total: number;` - Общая сумма всего заказа

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `deleteBasketCard(card: ICard, payload: Function | null): void` - удаляет товар из корзины
- `changeTotal(total: number, payload: Function | null):void;` - метод который пересчитывает обшую сумму заказа 

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

- `constructor(selector: string, events: IEvents)` - Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для возможности инициации событий.

Поля класса 

- `modal: HTMLElement` - элемент модального окна
- `closeModal` - кнопка закрытия модалки
- `events: IEvents` - брокер событий

#### Класс ModalBasket 
Расширяет класс Modal. Предназначен для реализации модального окна корзины. При открытии модального окна предоставляет данные выбранных товаров, возможность удаление выбранного товара и счетчик общей суммы заказа. Если в корзине есть хоть какие-то данные дает возможность оформить заказ\ 
Поля класса: 
- `submitOrder: HTMLButtonElement` - Кнопка оформления заказа
- `itemCard: HTMLElement` - Элемент товара помещенный в корзину 
- `deleteButtonItem: HTMLButtonElement` - Кнопка удаление элемента в корзине

Методы: 
- `setValid(isValid: boolean):void ` - изменяет активность кнопки офрмления заказа (если в корзине есть какой то элемент)
- `get form: HTMLElement` - геттер для получения элемента формы.

#### Класс ModalOrderPayment 
Расширяет класс Modal. Предназначен для реализации модального окна оформления заказа(форма оплаты, адресс). В модальном окне реализиван функционал позволяющий пользователю указать способ оплты и адресс доставки.\
Поля класса:
- `onlineButton` - кнопка способ оплаты онлайн 
- `receivingButton` - кнопка способ оплаты при получении
- `_form` - элемент формы
- `submitThen: HTMLButtonElement` - Кнопка далее в фомре

Методы:
- `setValid(isValid: boolean):void ` - изменяет активность кнопки далее (если все данные заполнены)
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- `showInputError (field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанным полем ввода
- `hideInputError (field: string): void` - очищает текст ошибки под указанным полем ввода


#### Класс ModalOrderData 
Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей поля ввода. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки оплаты\
Поля класса: 
- `inputEmail` - поле ввода почты
- `inputPhone` - поле ввода телефона
- `submitPayment: HTMLButtonElement` - Кнопка оплата в фомре

Методы: 
- `setValid(isValid: boolean):void ` - изменяет активность кнопки далее (если все данные заполнены)
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- `showInputError (field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанным полем ввода
- `hideInputError (field: string): void` - очищает текст ошибки под указанным полем ввода

#### Класс ModalDecorated
Расширяет класс Modal. Предназначен для реализации модального окна с данными общей суммы покупки пользователя. Класс дает возможность очистить корзину
Поля класса:
- `totalPrice` - данные общей суммы покупками
- `submitButton` - кнопка которая закрывает модальное окно и очищает корзину

Методы: 
- `close (): void` - расширяет родительский метод дополнительно при закрытии очищая поля формы

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. Предоставляет метод addCard(cardElement: HTMLElement) для добавления карточек на страницу и сеттер container для полного обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts
В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `Basket:open` - открытие модального окна корзины
- `CardElement:open` - открытие модального окна карточки
- `choice: button` - выбор кнопки способа оплаты
- `address: input` - введение данных адреса доставки
- `email: input` - введение данных почты 
- `phone: input` - введение данных телефона
- `choice: validation` - событие, сообщающее о необходимости валидации формы способа оплаты 
- `address: validation` - событие, сообщающее о необходимости валидации формы адреса доставки
- `email: validation` - событие, сообщающее о необходимости валидации формы email
- `phone: validation` - событие, сообщающее о необходимости валидации формы phone

